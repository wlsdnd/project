<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=yes, target-densitydpi=medium-dpi">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="common.css">
    <!-- <script src="http://code.jquery.com/jquery-latest.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>game</title>
</head>
<body>
    <div id="wrap">
        <div class="container">
            <div class="content">
                <h1 class="title">로또 추첨</h1>
                <ul class="result"></ul>
                <button class="create">Create</button>
                <p class="subText">클릭하면 저번주 당첨 번호가 33% 확률로 추첨</p>
                <button class="btn type1">Last week 33%</button>
                <p  class="subText">클릭하면 저저번주 당첨 번호가 10% 확률로 추첨</p>
                <button class="btn type2">2 weeks ago 10%</button>
                <p class="lastWeeksNo">저번주 1등 당첨 번호 (<span class="drawNo"></span>회)</p>
                <ul class="lastWeeksList"></ul>
                <p class="tip">자동 : <span class="first"></span>, 수동 : <span class="last"></span></p>
                <ul class="percent">
                    <li class="percent33">33% 적용중</li>
                    <li class="percent10">10% 적용중</li>
                </ul>
                <button class="reset" title="확률 초기화"></button>
                <button class="drawSearch">회차별 조회하기</button>
            </div>
            <div class="layerPupop">
                <div class="layerContainer">
                    <div class="layerContent">
                        <div class="resultBox">
                            <h2></h2>
                            <ul class="resultList">
                                <li class="numbers">
                                    <strong>1등 당첨 번호</strong>
                                    <ul></ul>
                                </li>
                                <li class="bonusNo">
                                    <strong>보너스 번호</strong>
                                    <span></span>
                                </li>
                                <li class="divisionsP">
                                    <strong>당첨금액</strong>
                                    <span></span>
                                </li>
                                <li class="divisionsW">
                                    <strong>당첨게임 수</strong>
                                    <span></span>
                                </li>
                                <li class="combination">
                                    <strong>비고</strong>
                                    <span></span>
                                </li>
                            </ul>
                        </div>
                        <div class="searchBox">
                            <h2>회차별 조회하기</h2>
                            <input class="drawForm" type="text" title="회차를 입력하세요." placeholder="검색하실 회차를 입력하세요.">
                            <button class="search">검색</button>
                        </div>
                        <button class="close" title="닫기"></button>
                    </div>
                </div>
            </div>
            <span class="version">v0.1 developer woong</span>
        </div>
    </div>
    <script>
        let lastWeeks = []
        let last2Weeks = []
        let lastDrawNo
        $.ajax({
            method: 'GET',                             // HTTP 요청 방식(GET, POST)
            url: 'https://smok95.github.io/lotto/results/latest.json',   // 서버의 URL 주소
            dataType: 'json'                             // 서버에서 보내줄 데이터의 타입
        }).done(function (data) {       // HTTP 요청이 성공하면 요청한 데이터가 done() 메소드로 전달됨.
            console.log(data);
            let weekColor = '#fbc400'
            for(let s=0; s<data.numbers.length; s++){
                if(data.numbers[s] >=10 && data.numbers[s] < 20){
                    weekColor = '#69c8f2'
                }else if(data.numbers[s] >=20 && data.numbers[s] < 30){
                    weekColor = '#ff7272'
                }else if(data.numbers[s] >=30 && data.numbers[s] < 40){
                    weekColor = '#aaa'
                }else if(data.numbers[s] >=40 && data.numbers[s] < 50){
                    weekColor = '#b0d840'
                }
                $('.lastWeeksList').append(`<li class="lastWeeks${[s]}" style="background-color:${weekColor}">${data.numbers[s]}</li>`)
                $('.drawNo').text(data.draw_no)
                $('.tip .first').text(data.winners_combination.auto)
                $('.tip .last').text(data.winners_combination.manual)
                lastDrawNo = data.draw_no
            }
                $(".btn.type1").click(function(){
                    lastWeeks = data.numbers
                    alert('저번주 당첨번호의 추첨 확률이 적용되었습니다.')
                    $('.percent33').show()
                })
            // $.each(data, function (i, item) {  //each(매개변수, 함수)
            //     $('#result').append(`<h3>${item.title}</h3><p>${item.body}</p>`)
            // });
        });
        function getColor(number){
            let color = "#fbc400"; // 10 미만
            if(number >=10 && number < 20){
                color = "#69c8f2"
            }else if(number >=20 && number < 30){
                color = "#ff7272"
            }else if(number >=30 && number < 40){
                color = "#aaa"
            }else if(number >=40 && number < 50){
                color = "#b0d840"
            }
            return color;
        }
        // 숫자 여섯개 당구공을 생성하여 문서에 뿌려준다!
        function displayNumbers(lotto){
            // 원래 보이던 당구공들은 제거하고 시작!
            $(".result").empty();
            for(let i =0; i < 6; i++){
                const li = $("<li></li>") // 제이쿼리판 createElement
                $(li).text(`${lotto[i]}`)
                $(li).hide(); // 안 보이는 상태에서 추가하기
                $(li).css("background-color", getColor(lotto[i]))
                $(".result").append(li)
            }
            $(".result > li").fadeIn(1000); // 1초 동안 스르륵 등장!
        }

        // 1부터 45 사이의 숫자 중 여섯개로 골라줘라!(무작위로)
        function createNumbers(){
            const lottoNumbers = []
            // 로또번호 여섯개가 다 안뽑혔다면 게속해라!
            while(lottoNumbers.length < 6){
                let randomNumber = Math.floor(Math.random() * 45) + 1
                if(lottoNumbers.indexOf(randomNumber) === -1){
                    if(Math.floor(Math.random() * 3) + 1 == 1) {
                        if(randomNumber != lastWeeks[0]
                        && randomNumber != lastWeeks[1]
                        && randomNumber != lastWeeks[2]
                        && randomNumber != lastWeeks[3]
                        && randomNumber != lastWeeks[4]
                        && randomNumber != lastWeeks[5]){
                        lottoNumbers.push(randomNumber)
                        console.log('50% 확률로 입력한 번호 안나옴', randomNumber)
                        }
                    }else if(Math.floor(Math.random() * 10) + 1 == 1){
                        if(randomNumber != last2Weeks[0]
                        && randomNumber != last2Weeks[1]
                        && randomNumber != last2Weeks[2]
                        && randomNumber != last2Weeks[3]
                        && randomNumber != last2Weeks[4]
                        && randomNumber != last2Weeks[5]){
                        lottoNumbers.push(randomNumber)
                        console.log('10% 확률로 입력한 번호 안나옴', randomNumber)
                        }
                    }else{
                        lottoNumbers.push(randomNumber)
                        console.log('확률 false 떠서 나옴', randomNumber)
                    }
                }
                //오름차순으로 숫자 정렬
                lottoNumbers.sort(function(a,b){
                    return a - b;
                });
            }
            displayNumbers(lottoNumbers)
        }
        $(".create").click(function(){
            createNumbers()
        })
        $('.btn.type2').click(function(){
            $.ajax({
            method: 'GET',                             // HTTP 요청 방식(GET, POST)
            url: `https://smok95.github.io/lotto/results/${lastDrawNo-1}.json`,   // 서버의 URL 주소
            dataType: 'json'                             // 서버에서 보내줄 데이터의 타입
            }).done(function (data) {       // HTTP 요청이 성공하면 요청한 데이터가 done() 메소드로 전달됨.
                last2Weeks = data.numbers
            });
            alert('저저번주 당첨번호의 추첨 확률이 적용되었습니다.')
            $('.percent10').show()
        })
        $('.reset').click(function(){
            lastWeeks = []
            last2Weeks = []
            $('.percent33').hide()
            $('.percent10').hide()
        })
        $('.drawSearch').click(function(){
            $('.layerPupop').fadeIn()
        })
        $('.layerContent .close').click(function(){
            $('.layerPupop').fadeOut()
            $('.searchBox h2').fadeIn()
            $('.resultBox').fadeOut()
            $('.searchBox .drawForm').val('')
        })
        $('.searchBox .search').click(function(){
            let searchDraw = $('.searchBox .drawForm').val()
            if(searchDraw > lastDrawNo){
                alert(`가장 최신 회차는 ${lastDrawNo}회 입니다.`)
            }else{
                $('.resultBox').show()
            $.ajax({
            method: 'GET',                             // HTTP 요청 방식(GET, POST)
            url: `https://smok95.github.io/lotto/results/${searchDraw}.json`,   // 서버의 URL 주소
            dataType: 'json'                             // 서버에서 보내줄 데이터의 타입
            }).done(function (data) {       // HTTP 요청이 성공하면 요청한 데이터가 done() 메소드로 전달됨.
                $('.resultBox h2').append(`<span>${data.date.substr(0, 10)}</span>`)
                $(".numbers ul").empty();
                for(let b=0; b<6; b++){
                    $('.numbers ul').append(`<li>${data.numbers[b]}</li>`)
                }
                $('.bonusNo span').text(data.bonus_no)
                $('.divisionsP span').text(`${data.divisions[0].prize.toLocaleString()}원`)
                $('.divisionsW span').text(`${data.divisions[0].winners}명`)
                if(typeof data.winners_combination.auto === 'undefined'){
                    $('.combination span').text('자동 : 조회불가 수동 : 조회불가')
                }else{
                    $('.combination span').text(`자동 : ${data.winners_combination.auto}명 수동 : ${data.winners_combination.manual}명`)
                }
            });
            $('.resultBox h2').text(`${searchDraw} 회`)
            $('.searchBox h2').hide()
            }
        })

    </script>
</body>
</html>